// SPDX-FileCopyrightText: Copyright 2025 Carabiner Systems, Inc
// SPDX-License-Identifier: Apache-2.0

syntax = "proto3";
package carabiner.signer.v1;

option go_package = "github.com/carabiner-dev/signer/api/v1";

// Identity captures a signer identity. An identity can one of:
//   a) A sigstore identity
//   b) A key
//   c) A reference to an identity defined outside the policy
message Identity {
    string id = 1;
    optional IdentitySigstore sigstore = 2;
    optional IdentityKey key = 3;
    optional IdentityRef ref = 4;
}

// IdentitySigstore represents the identity data in a Fulcio cert.
message IdentitySigstore {
    optional string mode = 1; // exact | regexp
    string issuer = 2;        // https://accounts.google.com
    string identity = 3;      //  "identity": "puerco@gmail.com"
}

// IdentityKey registers the data of a key used to sign attestations.
message IdentityKey {
    string id = 1;   // Key ID
    string type = 2; // Identity type
    string data = 3; // Public key data
}

// IdentityRef represents an identity defined outside of the policy. Most commonly
// these identities will be defined at the policy set level to have a common
// definition that can be reused by all policies in a set. 
message IdentityRef {
    string id = 1;
}
